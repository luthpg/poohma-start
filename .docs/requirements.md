# 家族間アカウント管理アプリ「PoohMa」要件定義書

**プロジェクト名:** PoohMa (プーマ)
**バージョン:** 1.0.0
**最終更新日:** 2026/02/10

---

## 1. プロジェクト概要

### 1.1 背景

現代の家庭において、動画配信、公共料金、教育サービスなど、家族で共有すべきアカウント情報が急増している。しかし、実パスワードを安易に共有することはセキュリティリスクを伴い、情報の散逸は利便性を損なう。

### 1.2 目的

* **パスワードのヒント運用による安全な情報管理:** 実パスワードを保存せず「ID + ヒント」という形で管理し、心理的・実質的な漏洩リスクを低減する。
* **家族間アクセスの透明化:** 「誰がどのアカウントを管理しているか」を可視化し、家族内での問い合わせコストを削減する。
* **視覚的な管理:** OGPを活用し、直感的にサービスを識別できるユーザー体験を提供する。

---

## 2. ユーザー・組織定義

### 2.1 ユーザー (User)

* サービスを利用する個人。Firebase Authによって認証される。

### 2.2 家族グループ (Family)

* 情報共有の境界線。
* **制約:** 1人のユーザーは **0または1つの家族グループ** にのみ所属できる。

---

## 3. 機能要件 (Functional Requirements)

### 3.1 レコード管理 (Service Record)

1つのWebサービスにつき、1つのレコードを作成し、以下の情報を保持する。

* **基本プロパティ:**
  * サービス名（URLから自動取得、または手入力）
  * URL
  * OGP画像（一覧・詳細での識別用）
  * OGP説明文
  * メモ（自由記述）
* **アカウント情報 (1対N):**
  * 1つのレコードに対し、複数のID情報を紐付け可能（例: 夫用、妻用、子供用）。
  * 各項目: ラベル、ログインID、**パスワードのヒント**。
  * *注意: セキュリティ上、実パスワードの入力欄は設けない。*
* **タグ管理 (1対N):**
  * レコードに対し、複数のタグを自由に付与可能。

### 3.2 共有と権限 (Permissions)

レコードごとに「公開設定」を選択し、以下の権限モデルを適用する。

| 公開設定 | 閲覧権限 | 編集・削除権限 |
| :--- | :--- | :--- |
| **Private** | 作成者本人のみ | 作成者本人のみ |
| **Shared** | 所属する家族全員 | **所属する家族全員 (Wiki方式)** |

### 3.3 ダッシュボードと検索

* **表示対象:** 「自分が作成したレコード」および「家族がShared設定したレコード」。
* **動的タグフィルター:** * フィルターとして表示されるタグは、**現在閲覧可能な全レコードに付与されているタグの和集合**とする。
  * タグを選択することで、表示対象のレコードを即座に絞り込む。

### 3.4 OGP連携

* URLを入力した際、バックエンドで対象サイトのメタ情報を取得し、タイトルと画像をフォームに自動補完する。

---

## 4. 非機能要件 (Non-Functional Requirements)

### 4.1 セキュリティ

* **通信:** 全ての通信をHTTPSで暗号化。
* **認証:** Firebase Authenticationを利用し、セッション管理を行う。
* **認可:** データベースのRow Level Security (RLS) を活用し、他者のPrivateレコードへのアクセスを物理的に遮断する。

### 4.2 パフォーマンス

* **高速な表示:** Viteベースのメタフレームワーク（TanStack Start）を採用し、軽快なSPA動作を実現する。
* **OGP取得:** 取得処理は非同期で行い、メインアプリのレスポンスを妨げない。

### 4.3 ユーザビリティ

* **モバイルファースト:** スマホでの「外出先からのID確認」を主用途とし、コピー＆ペーストのしやすさを追求する。

---

## 5. データモデル概要

### 5.1 主要エンティティ

* **Family:** ID, Name, CreatedAt
* **User:** ID, Email, DisplayName, FamilyID (FK)
* **ServiceRecord:** ID, UserID, FamilyID, Title, URL, OgpImage, Visibility
* **AccountCredential:** ID, RecordID, Label, LoginID, PasswordHint
* **Tag:** ID, RecordID, Name

---

## 6. 画面遷移案

1. **ログイン画面:** Firebase Authによる認証。
2. **ダッシュボード:** サービス一覧、タグフィルター。
3. **レコード詳細:** アカウント情報一覧、OGPプレビュー、編集ボタン。
4. **レコード編集/作成:** URL入力（OGP取得）、情報のCRUD。
5. **家族設定:** 家族作成、メンバー招待、脱退。
